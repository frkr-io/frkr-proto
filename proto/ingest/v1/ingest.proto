syntax = "proto3";

package frkr.ingest.v1;

option go_package = "github.com/frkr-io/frkr-proto/go/ingest/v1;ingestv1";

// IngestService handles the ingestion of mirrored traffic
service IngestService {
  // Ingest accepts a stream of mirrored requests
  rpc Ingest(IngestRequest) returns (IngestResponse);
}

// IngestRequest represents a request to ingest a mirrored API request
message IngestRequest {
  string stream_id = 1;
  MirroredRequest request = 2;
}

// MirroredRequest represents a mirrored HTTP request
message MirroredRequest {
  string method = 1;
  string path = 2;
  map<string, string> headers = 3;
  string body = 4;
  map<string, string> query = 5;
  int64 timestamp_ns = 6;
  string request_id = 7;
}

// IngestResponse represents the response from the ingest gateway
message IngestResponse {
  bool success = 1;
  string error = 2;
  string message_id = 3;
}
